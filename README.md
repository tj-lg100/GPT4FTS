# GPT4FTS

LLM-based framework for financial time series forecasting with two-stage training strategy.

## Requirements

```bash
pip install -r requirements.txt
```

## Quick Start

### Step 1: Generate Segments

The `segments/` directory must be generated by running SIPR scripts in the `SIPR/` directory.

```bash
cd SIPR
jupyter notebook
# Run SIPR_hs.ipynb, SIPR_nd.ipynb, SIPR_sp.ipynb, or SIPR_zz.ipynb
```

This generates segmentation files (e.g., `segments/sipr_hs300_k12_l8-16_dba_kmpp_segmentation.csv`).

### Step 2: Stage 1 Pre-training

Conduct Casual Next-patch Continual Pre-training:

```bash
bash ./scripts/pretrain/all_s16.sh
```

**Important**: Place the generated `.pth` file in `checkpoints/pt_patch/test/pt_ckpt/`:

```bash
mkdir -p checkpoints/pt_patch/test/pt_ckpt
cp checkpoints/pt_patch/ETTh1_ETTm1_ETTh2_ETTm2_weather_traffic_electricity_illness/pretrain_LLM4TS_pt_*/checkpoint.pth checkpoints/pt_patch/test/pt_ckpt/
```

### Step 3: Stage 2 Fine-tuning

Run forecasting with segments and pre-trained checkpoint:

```bash
bash ./scripts/long-term-forecasting/hs300.sh
```

This uses:
- Segmentation file from Step 1: `--segment_csv_path`
- Pre-trained checkpoint from Step 2: `--pt_sft_base_dir` and `--pt_sft_model`

## Project Structure

```
GPT4FTS/
├── SIPR/                        # Time series pattern recognition
│   ├── SIPR_hs.ipynb           # Generate segments for HS300
│   ├── SIPR_nd.ipynb           # Generate segments for ND100
│   ├── SIPR_sp.ipynb           # Generate segments for SP500
│   └── SIPR_zz.ipynb           # Generate segments for ZZ500
├── models/                      # Model architectures
├── scripts/
│   ├── pretrain/               # Stage 1 pre-training scripts
│   └── long-term-forecasting/  # Stage 2 fine-tuning scripts
├── run_LLM4TS.py               # Main entry point
└── requirements.txt
```

## Key Features

- Two-stage training: continual pre-training + fine-tuning
- Dynamic segmentation via SIPR
- Wavelet transform enhancement (LDWT)
- Support for HS300, ND100, SP500, ZZ500 indices
